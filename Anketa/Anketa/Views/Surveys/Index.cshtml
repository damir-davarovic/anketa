@model Anketa.Models.SurveyIndexModel
@using Microsoft.AspNet.Identity;
@using Anketa.Models;
@using Microsoft.AspNet.Identity.EntityFramework;
@using Anketa.App_Start;
@using System.Web.Mvc;

<h2>@ViewBag.Title</h2>
<nav class="navbar navbar-default navbar-inverse">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand">Surveys menu</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li role="presentation" class="active"><a data-toggle="pill" href="#all">All Surveys</a></li>
        @if(Request.IsAuthenticated){
        <li role="presentation"><a data-toggle="pill" href="#my">My Surveys</a></li>
        }
      </ul>
      @if(Request.IsAuthenticated){
      <ul class="nav navbar-nav navbar-right">
         <li role="presentation" class="navbar-right navbar-control">@Html.ActionLink("Create new", "Create", new { controller = "Surveys" } )</li>
      </ul>
      }
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

<div class="tab-content">
    <div id="all" class="tab-pane fade in active">
        <table id="all-surveys">
            <thead>
                <tr>
                    <th>@Html.DisplayNameFor(model => model.surveyModel.ownerID)</th>
                    <th>@Html.DisplayNameFor(model => model.surveyModel.surveyName)</th>
                    <th>@Html.DisplayNameFor(model => model.surveyModel.creationDate)</th>
                    <th>@Html.DisplayNameFor(model => model.surveyModel.surveyActive)</th>
                    <th>Actions:</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var item in Model.allSurveysList) {
            <tr>
                <td>@Model.dictUser[Convert.ToInt32(item.ownerID)]</td>
                <td>@Html.DisplayFor(modelItem => item.surveyName)</td>
                <td>@Html.DisplayFor(modelItem => item.creationDate)</td>
                <td>@Html.DisplayFor(modelItem => item.surveyActive)</td>                
                <td class="text-left"> 
                    @if(@Model.currentUser == Convert.ToInt64(item.ownerID)) {
                    <div class="btn-group btn-group-sm">
                        @if(item.surveyActive){
                        @Html.ActionLink("Solve", "Solve", new { controller = "Surveys", Id = item.surveyID }, new{ @class = "btn btn-success"})
                        }else{
                            <button type="button" class="btn btn-disabled">Solve</button>
                        }
                      <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="caret"></span>
                        <span class="sr-only">Toggle Dropdown</span>
                      </button>
                      <ul class="dropdown-menu">
                        <li>@Html.ActionLink("Edit", "Edit" , new { controller = "Surveys" , Id = item.surveyID })</li>
                        <li>@Html.ActionLink("Details", "Details", new { controller = "Surveys" , Id = item.surveyID })</li>
                        <li>@Html.ActionLink("Delete", "Delete", new { controller = "Surveys" , Id = item.surveyID })</li>
                        <li role="separator" class="divider"></li>
                        <li>@Html.ActionLink("Modify questions", "Details", new { controller = "Surveys" , Id = item.surveyID })</li>
                      </ul>
                    </div>
                    }
                    else{
                    <div class="btn-group btn-group-sm">
                        @if(item.surveyActive){
                            @Html.ActionLink("Solve", "Solve", new { controller = "Surveys", Id = item.surveyID }, new{ @class = "btn btn-success"} )
                        }else{
                            <button type="button" class="btn btn-disabled">Solve</button>
                        }                        
                    </div>
                    }
                </td>           
            </tr>
            }
            </tbody>
    </table>
    </div>
    <div id="my" class="tab-pane fade">
        <h3>Surveys you have created.</h3>
        <table id="my-surveys" class="display table">
            <thead>
            <tr>
                <th>@Html.DisplayNameFor(model => model.surveyModel.ownerID)</th>
                <th>@Html.DisplayNameFor(model => model.surveyModel.surveyName)</th>
                <th>@Html.DisplayNameFor(model => model.surveyModel.creationDate)</th>
                <th>@Html.DisplayNameFor(model => model.surveyModel.surveyActive)</th>
                <th>Actions:</th>
            </tr>
            </thead>
            <tbody>
            @foreach (var item in Model.allSurveysList) {
                if(@Model.currentUser == Convert.ToInt64(item.ownerID)) { 
            <tr>
                <td>@Model.dictUser[Convert.ToInt32(item.ownerID)]</td>
                <td>@Html.DisplayFor(modelItem => item.surveyName)</td>
                <td>@Html.DisplayFor(modelItem => item.creationDate)</td>
                <td>@Html.DisplayFor(modelItem => item.surveyActive)</td>
                <td>
                    <div class="btn-group btn-group-sm">                    
                      @if(item.surveyActive){
                        @Html.ActionLink("Solve", "Solve", new { controller = "Surveys", Id = item.surveyID }, new{ @class = "btn btn-success"})
                        }else{
                            <button type="button" class="btn btn-disabled">Solve</button>
                        }
                      <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="caret"></span>
                        <span class="sr-only">Toggle Dropdown</span>
                      </button>
                      <ul class="dropdown-menu">
                        <li>@Html.ActionLink("Edit", "Edit" , new { controller = "Surveys" , Id = item.surveyID })</li>
                        <li>@Html.ActionLink("Details", "Details", new { controller = "Surveys" , Id = item.surveyID })</li>
                        <li>@Html.ActionLink("Delete", "Delete", new { controller = "Surveys" , Id = item.surveyID })</li>
                        <li role="separator" class="divider"></li>
                        <li>@Html.ActionLink("Modify questions", "Details", new { controller = "Surveys" , Id = item.surveyID })</li>
                      </ul>
                    </div>
                </td>
            </tr>
                }
            }
        </tbody>
       </table>
    </div>
</div>